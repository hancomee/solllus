<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Admin</title>

    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">

    <link href='/dist/fonts/SpoqaHanSansNeo.css' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/dist/lib/css/reboot.css"/>
    <link rel="stylesheet" href="/dist/admin.css"/>

    <style id="style"></style>

</head>

<body data-template="body">

<nav>

    <a href="/admin" class="brand">
        <i>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
            </svg>
        </i>
        <span id="brand"></span>
    </a>

    <div class="ms-auto nav-btns">
        <a href="/dashboard" target="_parent" data-view="ADMIN">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-database-check" viewBox="0 0 16 16">
                <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548 1.17-1.951a.5.5 0 1 1 .858.514Z"/>
                <path d="M12.096 6.223A4.92 4.92 0 0 0 13 5.698V7c0 .289-.213.654-.753 1.007a4.493 4.493 0 0 1 1.753.25V4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16c.536 0 1.058-.034 1.555-.097a4.525 4.525 0 0 1-.813-.927C8.5 14.992 8.252 15 8 15c-1.464 0-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13h.027a4.552 4.552 0 0 1 0-1H8c-1.464 0-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10c.262 0 .52-.008.774-.024a4.525 4.525 0 0 1 1.102-1.132C9.298 8.944 8.666 9 8 9c-1.464 0-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777ZM3 4c0-.374.356-.875 1.318-1.313C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4Z"/>
            </svg>
        </a>
        <a id="admin" data-view="ADMIN" target="_blank">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list-columns-reverse" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                      d="M0 .5A.5.5 0 0 1 .5 0h2a.5.5 0 0 1 0 1h-2A.5.5 0 0 1 0 .5Zm4 0a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10A.5.5 0 0 1 4 .5Zm-4 2A.5.5 0 0 1 .5 2h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 4h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 6h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 8h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5Z"/>
            </svg>
        </a>
        <span data-view="ADMIN" data-event="supremeMenu">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
  <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
  <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
</svg>
        </span>
        <div data-view="ADMIN" class="dropdown" x-placement="right">
            <svg data-event="userLink" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-lines-fill"
                 viewBox="0 0 16 16">
                <path d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-5 6s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zM11 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5zm.5 2.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1h-4zm2 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-2zm0 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-2z"/>
            </svg>
            <div class="dropdown-menu">
                <select></select>
            </div>
        </div>
        <a href="/logout" target="_parent">로그아웃</a>
    </div>
</nav>

<div class="supreme-panel">
    <div>
        <span class="btn delete-user" data-event="removeUser">사용자 삭제</span>
    </div>
    <div>
        <input name="index" placeholder="디스플레이 번호">
        <span class="btn" data-event="addDisplay">디스플레이 추가</span>
    </div>
    <div>
        <input name="pass" placeholder="password">
        <input name="role" placeholder="roles">
        <span class="btn" data-event="modifyUser">저장</span>
    </div>
    <div>
        <span class="btn" data-event="mediaUpload">파일 업로드</span>
        <span class="btn ms-auto" data-event="supremeMenu">Close</span>
    </div>
</div>


<div class="display-container">
    <div class="display-row" data-template="?display">
        <div class="display content-container"
             data-set-attrs="index:data.index; root:data.content.root; path:data.content.path;
             name:data.content.name; mediaType:data.content.mediaType">
            <div class="content-header">
                <a target="_blank" data-anchor></a>
                <span class="ms-auto" data-event="reload">(Reload)</span>
                <span data-view="ADMIN" data-event="removeDisplay">×</span>
            </div>
            <div class="content-body" data-event="open_display">
                <div data-thumb></div>
            </div>
        </div>
    </div>
</div>


<div class="manager">

    <div class="manager-body container-fluid">

        <!-- 컨텐츠 -->
        <div class="content" data-event="select_content"
             data-set-attrs="root:data.root; path:data.path; name:data.name; mediaType:data.mediaType"
             data-template="?content">
            <div class="content-container">
                <div class="content-header">
                    <b class="media-type" data-set-content-type></b>
                </div>
                <div class="content-body">
                    <div class="media-float" data-content></div>
                </div>
                <div class="content-supreme" data-view="ADMIN">
                    <div data-approval-view="0" data-event="addContent">★</div>
                    <div data-approval-view="1" data-event="removeContent">★</div>
                    <div class="del-media" data-view="ADMIN" data-event="deleteContent">×</div>
                </div>
            </div>
        </div>

    </div>

    <!-- 텍스트 -->
    <div class="manager-footer">
        <div class="content-text">
            <input class="" id="text-input" spellcheck="false" autocomplete="off">
            <span data-event="text"><b data-event="text_reset">×</b>Send</span>
        </div>
    </div>

    <div class="manager-notice">
        <div class="text-center">
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-double-up" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M7.646 2.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 3.707 2.354 9.354a.5.5 0 1 1-.708-.708l6-6z"/>
                    <path fill-rule="evenodd" d="M7.646 6.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 7.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
                </svg>
            </div>
            <div><strong>디스플레이를 선택해주세요</strong></div>
            <div>좌우 스크롤</div>
        </div>
    </div>
</div>


<div id="pop-up">Please Wait....</div>

<script src="/dist/lib/js/js-base.js"></script>
<script src="/dist/js-boosteel.js"></script>

<script>

    (function () {

        function $run($username, $root = 'users', $displayMap) {

            document.getElementById('brand').textContent = $username;

            const

                {body} = document,
                [$supremePanel, $style, $manager, $contentRow, $displayRow, $textInput, $managerBody, popUp] =
                    JS.selector('.supreme-panel style .manager .content-row .display-container text-input .manager-body pop-up'),

                Body = new class Body extends JS.Template {


                    constructor() {
                        super();
                    }

                    contentKey(data) {
                        return data ? [data.root, data.path, data.name].join('/') : '';
                    }

                    media($content, displayIndex) {
                        const {hasAdmin, mediaType, name, meta} = $content;
                        if (/image/i.test(mediaType)) {
                            return JS.replace('<img src="/{root}/{path}/{name}">', $content);
                        } else if (/mp4/i.test(mediaType)) {
                            return JS.replace('<video preload="metadata"><source src="/{root}/{path}/{name}" type="video/mp4"></video>', $content);
                        }
                        // app
                        else if (/html/i.test(mediaType)) {
                            const array = ['<b>' + (meta.split(/\n/)[0].trim() || name) + '</b>'];
                            if (hasAdmin) {
                                let href = '/' + ['app', $content.root, $content.path, $content.name].join('/') +
                                    '?name=' + $username + '&index=' + displayIndex;
                                array[1] = JS.replace('<a class="app-admin" href="{0}" target="_self">설정</a>', [href]);
                            }
                            return '<div class="app-thumb">' + array.join('') + '</div>';
                        }
                    }

                    getDisplay() {
                        const ele = document.querySelector('.display[data-index="' + body.dataset.display + '"]');
                        return ele ? JS.Template.$get(ele) : null;
                    }

                    // 선택된 컨텐츠 체크
                    checkContent() {
                        const $display = this.getDisplay();
                        if ($display) {
                            const {root, path, name} = $display.data,
                                key = [root, path, name].join('/');
                            forEach.call(document.getElementsByClassName('content'), (ele) => {
                                if (key === ele.dataset.uri) ele.classList.add('active');
                                else ele.classList.remove('active');
                            })
                        }
                    }

                    // 열려진 디스플레이 체크
                    checkDisplay() {
                        forEach.call(document.getElementsByClassName('display'), (ele) => {
                            if (ele.dataset.index === body.dataset.display) ele.classList.add('active');
                            else ele.classList.remove('active');
                        });
                        this.checkContent();
                    }


                    show_displays() {
                        return ADMIN.getDisplays($username).then(values => {
                            $displayMap = {};
                            $displayRow.textContent = '';
                            if (values) {
                                for (let p in values) {
                                    $displayMap[p] = new Display().setData(values[p]).apply().appendTo();
                                }
                                this.checkDisplay();
                            }
                        });
                    }


                    // 디스플레이 클릭
                    open_display({index}) {

                        // 앱 목록들을 가지고 온다.
                        JS.fetch('/data/user/display/contents/' + $username + '?index=' + index)
                            .then(res => res.json())
                            .then((data) => {
                                $managerBody.textContent = '';
                                const [apps, userApps, registered] = data,
                                    sort = (a, b) => (a.path + a.name) > (b.path + b.name) ? 1 : -1,
                                    handler = app => new Content(app).setApproval(registered.indexOf(this.contentKey(app)) !== -1).apply().appendTo();

                                apps.sort(sort).forEach(handler);
                                userApps.sort(sort).forEach(handler);

                                JS.toggleClass($manager, 'active', true);
                                body.dataset.display = index;
                                $textInput.value = $displayMap[index].data.text;
                                this.checkDisplay();
                            })
                    }


                    select_content({display, root, path, name, approval}) {
                        if (!approval) return;
                        ADMIN.updateDisplay({index: display, root: root, path: path, name: name, user: $username, command: 1})
                            .then(() => this.show_displays())
                            .then(() => this.open_display({index: display}));
                    }

                    reload({$template}) {
                        ADMIN.reloadDisplay({index: $template.data.index, user: $username})
                    }


                    // 관리자 패널
                    supremeMenu({target}) {
                        if (!$supremePanel.classList.contains('open')) {
                            JS.fetch('/data/s/user/' + document.body.getAttribute('data-user'))
                                .then(res => res.json())
                                .then(userDetail => {
                                    const {authorities, password} = userDetail,
                                        {pass, role, index} = JS.elementsMap($supremePanel, 'name'),
                                        roles = authorities.map(({authority}) => authority).join(',');

                                    pass.value = password;
                                    role.value = roles;
                                    index.value = '';

                                    $supremePanel.classList.add('open');
                                })

                        } else $supremePanel.classList.remove('open');
                    }

                    userLink({target, link}) {
                        target = target.closest('.dropdown');
                        if (target.classList.contains('dropdown-open')) {
                            target.classList.remove('dropdown-open');
                        } else {
                            JS.fetch('/data/s/user/list').then(res => res.json()).then(list => {
                                const [select] = target.getElementsByTagName('select');

                                select.innerHTML = list.map(({username}) => {
                                    const s = username === $username ? ' selected' : '';
                                    return '<option ' + s + '>' + username + '</option>';
                                });


                                if (!select.oninput) {
                                    select.oninput = ({target}) => {
                                        let [option] = target.selectedOptions;
                                        location.href = '/admin/' + option.textContent;
                                    }
                                }
                                target.classList.add('dropdown-open');
                            })
                        }
                    }

                    modifyUser({target}) {
                        const {pass, role} = JS.elementsMap(target.parentElement, 'name');
                        JS.fetch('/data/s/user/register/' + $username + '?pass=' + pass.value.trim() + '&roles=' + role.value);
                    }

                    removeUser({}) {
                        if (confirm($username + ' 계정을 삭제하시겠습니까?')) {
                            JS.fetch('/data/s/user/remove/' + $username)
                                .then(res => res.json())
                                .then(success => success && location.reload())
                        }
                    }

                    addDisplay({target}) {
                        const
                            input = target.previousElementSibling,
                            index = input.value.trim();
                        JS.fetch('/data/s/display/create/' + [$username, index].join('/'))
                            .then(res => res.json())
                            .then(flag => {
                                if (flag === 1) {
                                    input.value = '';
                                    this.show_displays();
                                }
                            })
                    }

                    removeDisplay({index}) {
                        if (confirm('디스플레이 "' + index + '"가 삭제됩니다?')) {
                            JS.fetch('/data/s/display/remove/' + [$username, index].join('/'))
                                .then(() => {
                                    this.show_displays();
                                    // 현재 열려있으면
                                    if (body.dataset.display == index) {
                                        $managerBody.textContent = '';
                                        $manager.classList.remove('active')
                                    }
                                    this.show_displays();
                                    alert('삭제되었습니다.');
                                })
                                .then(() => ADMIN.reloadDisplay({index: index, user: $username}))
                        }
                    }

                    addContent({display, root, path, name}) {
                        JS.fetch('POST:/data/s/app/install', {user: $username, index: display, root: root, path: path, name: name})
                            .then(res => res.ok)
                            .then(() => this.open_display({index: display}));
                    }

                    removeContent({root, path, name, display}) {
                        if (confirm(path + '/' + name + '을 등록해제?')) {
                            JS.fetch('POST:/data/s/app/uninstall', {user: $username, index: display, root: root, path: path, name: name})
                                .then(res => res.ok)
                                .then(() => ADMIN.reloadByContent({user: $username, root: root, path: path, name: name}))
                                .then(() => {
                                    this.show_displays();
                                    this.open_display({index: display});
                                })
                        }
                    }


                    deleteContent({root, path, name}) {
                        if (confirm(path + '/' + name + '을 삭제하시겠습니까?')) {
                            const config = {user: $username, root: root, path: path, name: name};
                            JS.fetch('POST:/data/user/io/files/delete/' + $username, {paths: [root, path, name]})
                                .then(res => res.ok)
                                .then(() => ADMIN.updateContent(config))
                                .then(() => ADMIN.reloadByContent(config))
                                .then(() => {
                                    this.show_displays();
                                    body.dataset.display && this.open_display({index: body.dataset.display});
                                })
                        }
                    }

                    mediaUpload() {
                        JS.inputFile({
                            accept: ([file]) => {
                                if (/matroska|mp4|^image/i.test(file.type)) {
                                    popUp.classList.add('active');
                                    const data = new FormData(),
                                        {name} = file,
                                        filename = new Date().getTime() + name.slice(name.lastIndexOf('.')),
                                        config = {user: $username, root: 'users', path: $username, name: filename};

                                    data.append('config', JS.bodyBlob({paths: [config.root, config.path]}))
                                    data.append('files', file, filename);

                                    JS.fetch('PUT:/data/user/io/files/' + $username, data)
                                        .then(() => ADMIN.updateContent(config))
                                        .then(() => {
                                            // 열려진 디스플레이가 있으면 컨텐츠 목록 갱신
                                            body.dataset.display && this.open_display({index: body.dataset.display});
                                        })
                                        .then(() => popUp.classList.remove('active'));
                                }
                            }
                        })
                    }

                    text({target, display}) {
                        let input = target.closest('.content-text').getElementsByTagName('input')[0];
                        ADMIN.updateDisplay({index: display, user: $username, body: input.value, command: 0});
                    }

                    text_reset({target, display}) {
                        let input = target.closest('.content-text').getElementsByTagName('input')[0];
                        ADMIN.updateDisplay({index: display, user: $username, body: '', command: 0}).then(() => input.value = '');
                    }

                },


                Display = class extends JS.Template {

                    active(flag) {
                        flag ? this.element.classList.add('active') : this.element.classList.remove('active');
                    }

                    thumb(target, value, data = this.data) {
                        if (data) {
                            const {content} = data;
                            if (content) {
                                const key = Body.contentKey(content);
                                if (/html/.test(content.mediaType) || target.getAttribute('data-key') !== key) {
                                    target.setAttribute('data-key', key);
                                    target.innerHTML = Body.media(content, this.data.index);
                                }
                            } else {
                                target.textContent = '';
                            }
                        }
                    }

                    anchor(target, value, data = this.data) {
                        target.href = '/v/' + $username + '/' + data.index;
                        target.textContent = 'Link ' + data.index;
                    }

                },

                Content = class extends JS.Template {

                    constructor(data) {
                        super(data);
                        this.element.setAttribute('data-uri', [data.root, data.path, data.name].join('/'))
                    }

                    equals(data) {
                        return Body.contentKey(data) === Body.contentKey(this.data);
                    }

                    active(flag) {
                        flag ? this.element.classList.add('active') : this.element.classList.remove('active');
                    }

                    setApproval(flag) {
                        this.element.setAttribute('data-approval', flag ? '1' : '0');
                        return this;
                    }

                    setContentType(target) {
                        const {path, mediaType} = this.data;
                        if (/html/.test(mediaType)) target.textContent = path;
                        else target.textContent = mediaType.split('/')[0];
                    }

                    content(target) {
                        const {type} = target.dataset;
                        if (!/^image|^video/i.test(type)) target.innerHTML = Body.media(this.data);
                        target.dataset.type = this.data.mediaType;
                    }
                };

            JS.addEvent(Body);

            popUp.classList.add('active');
            Body.show_displays().then(() => popUp.classList.remove('active'));

        }

        // start ====>
        (function (suffixName) {

            ADMIN.getId().then(async ([id, roles]) => {

                id = suffixName || id;
                document.body.dataset.roles = roles.join(' ');

                // 관리자 접속
                if (roles.indexOf('ADMIN') !== -1) {

                    let noExists = true;

                    // 다른 계정 컨트롤하는 경우
                    if (suffixName) {
                        noExists = await JS.fetch('/data/i/has/' + suffixName).then(res => res.json());
                        noExists || (location.href = '/admin-register/' + suffixName);
                    }

                    $run(id);

                    document.body.classList.remove('supreme');
                    JS.fetch('/data/i/root').then(res => res.text()).then(root => {
                        const a = document.createElement('a'),
                            admin = document.getElementById('admin'),
                            [nav] = document.getElementsByTagName('nav');

                        // nav 클릭시 유저폴더 Explorer로 이동
                        a.target = '_black';
                        a.href = '/explorer?root=' + root + '/users/' + id + '&matched=' + root;
                        nav.addEventListener('dblclick', (e) => e.target === nav && a.click());

                        admin.href = '/explorer?root=' + root;
                        document.title = '@' + id + ' - ADMIN';
                    });

                }
                // 일반 사용자
                else {
                    $run(id);
                }

                document.body.setAttribute('data-user', id);
            });

        })(location.pathname.slice(1).split(/\//)[1])


    })();


</script>
</body>
</html>